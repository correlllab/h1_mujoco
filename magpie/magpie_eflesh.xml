<mujoco model="magpie_gripper">
  <compiler meshdir="assets" autolimits="true"/>

  <visual>
    <headlight ambient=".4 .4 .4" diffuse=".8 .8 .8" specular="0.1 0.1 0.1"/>
    <map znear=".01"/>
    <quality shadowsize="2048"/>
    <global elevation="-15"/>
  </visual>

  <asset>
    <texture name="blue_grid" type="2d" builtin="checker" rgb1=".02 .14 .44" rgb2=".27 .55 1" width="300" height="300" mark="edge" markrgb="1 1 1"/>
    <material name="blue_grid" texture="blue_grid" texrepeat="1 1" texuniform="true" reflectance=".2"/>

    <texture name="grey_grid" type="2d" builtin="checker" rgb1=".26 .26 .26" rgb2=".6 .6 .6" width="300" height="300" mark="edge" markrgb="1 1 1"/>
    <material name="grey_grid" texture="grey_grid" texrepeat="1 1" texuniform="true" reflectance=".2"/>
    <texture name="skybox" type="skybox" builtin="gradient" rgb1=".66 .79 1" rgb2=".9 .91 .93" width="800" height="800"/>

    <!-- Magpie gripper meshes (prefixed names for include compatibility) -->
    <mesh class="magpie" name="magpie_mount" file="mount.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_base_bot" file="base_bot.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_base_top" file="base_top.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_left_crank" file="left_crank.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_right_crank" file="right_crank.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_left_finger" file="left_finger_eflesh.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_right_finger" file="right_finger_eflesh.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_left_rocker" file="left_rocker.stl" scale="0.001 0.001 0.001"/>
    <mesh class="magpie" name="magpie_right_rocker" file="right_rocker.stl" scale="0.001 0.001 0.001"/>
  </asset>

  <default>
    <default class="magpie">
      <material specular="0.5" shininess="0.25"/>
      <default class="visual">
        <geom type="mesh" contype="0" conaffinity="0" group="2"/>
      </default>
      <default class="collision">
        <geom type="capsule" group="3"/>
        <default class="eef_collision">
          <geom type="cylinder"/>
        </default>
      </default>
      <site size="0.001" rgba="0.5 0.5 0.5 0.3" group="4"/>
    </default>
  </default>

  <worldbody>
    <!-- Include the gripper body hierarchy -->
    <include file="magpie_gripper.xml"/>
  </worldbody>

  <equality>
    <!-- Connect constraints close the 4-bar loop by pinning rocker to base at pivot4 (rocker-base) -->
    <!-- Anchor is in body1 (base_top) frame, from CAD with axis transform -->
    <!-- Left:  CAD (-60.0, -0.750, 65.0) -> MuJoCo (-0.00075, 0.060, 0.065) -->
    <!-- Right: CAD (60.0, -0.750, 65.0)  -> MuJoCo (-0.00075, -0.060, 0.065) -->
    <connect name="left_4bar_close" active="true" body1="base_top" body2="left_rocker" anchor="-0.00075 0.060 0.065"/>
    <connect name="right_4bar_close" active="true" body1="base_top" body2="right_rocker" anchor="-0.00075 -0.060 0.065"/>
  </equality>

  <actuator>
    <!-- Position actuators drive the crank (hinge_1) to control finger position -->
    <!-- ctrlrange maps to joint range; kp is position gain -->
    <position name="left_finger_actuator" joint="left_hinge_1" ctrlrange="-0.035 2.70" kp="10"/>
    <position name="right_finger_actuator" joint="right_hinge_1" ctrlrange="-2.70 0.035" kp="10"/>
  </actuator>
</mujoco>
